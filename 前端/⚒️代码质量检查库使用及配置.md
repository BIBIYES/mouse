# ⚒️代码质量检查库使用及配置

对于前端的代码质量检查，我们通常会使用以下库：

- ​**​`eslint`​**​ - 代码检查工具
- ​**​`husky`​**​ - Git 钩子
- **​`lint-staged` ​**​ - 用于在 Git 暂存区的文件上运行代码检查工具

## 1 `eslint`​ 使用

### 1.1 安装

推荐使用以下命令来安装 ESLint 并初始化配置：

```bash
npm init @eslint/config@latest
```

按照提示选择 `yes`​ 或 `no`​，它会自动添加并创建所需的依赖和配置。

### 1.2 一般配置

以下是一个典型的 ESLint 配置文件示例：

```powershell
import { defineConfig } from 'eslint/config'
import js from '@eslint/js'
import globals from 'globals'
import pluginVue from 'eslint-plugin-vue'
import { FlatCompat } from '@eslint/eslintrc'

const compat = new FlatCompat()
export default defineConfig([
  // 排除
  { ignores: ['dist/**', 'node_modules/**'] },
  ...compat.config({
    extends: ['./.eslintrc-auto-import.json']
  }),
  {
    files: ['**/*.{js,mjs,cjs,vue}'],
    languageOptions: { globals: globals.browser }
  },
  {
    files: ['**/*.{js,mjs,cjs,vue}'],
    rules: {
      // 强制使用单引号
      quotes: ['error', 'single'],
      // 禁止使用分号
      semi: ['error', 'never']
    }
  },
  js.configs.recommended,
  pluginVue.configs['flat/recommended']
])

```

- ​**​`globals`​**​：提供不同环境下的全局变量定义，帮助开发者编写更干净、更符合环境要求的代码。
- ​**​`pluginVue`​**​：包含适用于 Vue 的 ESLint 规则，使 Vue 语法检查更加规范。
- ​**​`js`​**​：专门处理 JavaScript 语法检查。
- ​**​`pluginVue.configs['flat/recommended']`​** ​：引入 `eslint-plugin-vue`​ 插件的推荐规则，适用于 ESLint v9 的扁平化配置。
- ​**​`FlatCompat`​**​：用于兼容旧版的 ESLint 配置文件，例如 `.eslintrc-auto-import.json`​，以便在新的平面配置中使用。

如果你不了解 ESLint 中的关键字和配置语法，可以参考 [ESLint 配置文件文档](https://eslint.nodejs.cn/docs/latest/use/configure/configuration-files)。

## 2 `husky` ​ 使用

### 2.1 安装

安装 Husky：

```bash
npm install --save-dev husky
```

### 2.2 初始化

初始化 Husky：

```bash
npx husky init
```

运行后，Husky 会自动配置 `package.json`​ 并在当前目录下创建 `.husky`​ 文件夹。文件夹中会创建一个 `pre-commit`​ 文件，我们可以在其中添加 `npx lint-staged`​。

### 2.3 配置

在 `.husky/pre-commit`​ 文件中添加以下内容：

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```

这表示在提交时会触发 `npx lint-staged`​ 脚本。

## 3 `lint-staged`​ 使用

### 3.1 安装

安装 `lint-staged`​：

```bash
npm install --save-dev lint-staged
```

### 3.2 配置

在 `package.json`​ 中添加以下配置：

```json
"lint-staged": {
    "**/*.{js,jsx,ts,tsx,vue}": "eslint --fix"
}
```

这表示在暂存区的文件中，所有 `.js`​、`.jsx`​、`.ts`​、`.tsx`​ 和 `.vue`​ 文件都会通过 ESLint 检查，并尝试自动修复问题。

## 4 处理 `autoimport`​ 的配置

为了处理 `autoimport`​，确保你已经安装了 `unplugin-auto-import`​ 插件，并在项目中正确配置了它。例如，在 `vite.config.js`​ 中：

```javascript
import { defineConfig } from "vite";
import AutoImport from "unplugin-auto-import/vite";

export default defineConfig({
  plugins: [
    AutoImport({
      imports: ["vue", "vue-router"],
      eslintrc: {
        enabled: true,
        filepath: "./.eslintrc-auto-import.json", // 生成 ESLint 兼容的全局变量配置文件
        globalsPropValue: true, // 将自动导入的 API 作为全局变量
      },
    }),
  ],
});
```

运行项目后，`unplugin-auto-import`​ 会自动生成 `.eslintrc-auto-import.json`​ 文件，其中包含自动导入的全局变量定义。然后，通过 `FlatCompat`​ 将其引入 ESLint 配置中，确保 ESLint 能够识别这些全局变量，避免报错。

## 5 额外配置建议

### 5.1 ESLint 配置

你可以根据项目需求添加更多规则。例如：

```javascript
{
    files: ['**/*.{js,mjs,cjs,vue}'],
    rules: {
        'no-unused-vars': 'warn',
        'no-console': 'error',
        'vue/no-unused-vars': 'error',
    },
}
```

### 5.2 Husky 配置

你可以添加更多 Git 钩子，例如 `pre-push`​，在推送时运行测试：

```bash
npx husky add .husky/pre-push "npm test"
```

### 5.3 Lint-Staged 配置

你可以为不同类型的文件配置不同的工具。例如：

```json
"lint-staged": {
    "**/*.{js,jsx,ts,tsx}": [
        "eslint --fix",
    ],
    "**/*.vue": [
        "eslint --fix",
    ],
    "**/*.css": "stylelint --fix"
}
```

---

‍
